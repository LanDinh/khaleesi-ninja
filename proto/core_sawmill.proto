syntax = "proto3";

package khaleesi.core.sawmill;

import "google/protobuf/timestamp.proto";
import "core.proto";


message Grpc {
  string khaleesi_gate    = 1;
  string khaleesi_service = 2;
  string grpc_service     = 3;
  string grpc_method      = 4;
}


message Metadata {
  google.protobuf.Timestamp timestamp = 1;
  Grpc                      logger    = 2;
}


message Event {

  message Target {
    string             type  = 1;
    int64              id    = 2;
    khaleesi.core.User owner = 3;
  }

  message Origin {
    oneof origin {
      khaleesi.core.User user   = 1;
      string             system = 2;
    }
  }

  message Action {
    enum ActionType {
      UNKNOWN_ACTION = 0;
      CREATE         = 1;
      READ           = 2;
      UPDATE         = 3;
      DELETE         = 4;
      CUSTOM         = 5;
    }

    enum ResultType {
      UNKNOWN_RESULT = 0;
      SUCCESS        = 1;
      WARNING        = 2;
      ERROR          = 3;
    }

    ActionType crud_type   = 1;
    string     custom_type = 2;
    ResultType result      = 3;
    string     details     = 4;
  }

  Metadata metadata = 1;
  Target          target   = 2;
  Origin          origin   = 3;
  Action          action   = 4;
}

message LogResponse {
  enum ResultType {
    UNKNOWN       = 0;
    SUCCESS       = 1;
    PARSING_ERROR = 2;
    FATAL_ERROR   = 3;
  }
  ResultType result = 1;
  string     errors = 2;
}

service Sawmill {
  rpc LogEvent (Event) returns (LogResponse);
}
