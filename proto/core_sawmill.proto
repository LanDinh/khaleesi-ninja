syntax = "proto3";

package khaleesi.core.sawmill;

import "google/protobuf/timestamp.proto";
import "core.proto";


message Metadata {
  google.protobuf.Timestamp         timestamp        = 1;
  google.protobuf.Timestamp         logged_timestamp = 2;
  khaleesi.core.GrpcRequestMetadata logger           = 3;
}


message Event {

  message Target {
    string             type  = 1;
    int64              id    = 2;
    khaleesi.core.User owner = 3;
  }

  message Action {
    enum ActionType {
      UNKNOWN_ACTION = 0;
      CREATE         = 1;
      READ           = 2;
      UPDATE         = 3;
      DELETE         = 4;
      CUSTOM         = 5;
    }

    enum ResultType {
      UNKNOWN_RESULT = 0;
      SUCCESS        = 1;
      WARNING        = 2;
      ERROR          = 3;
    }

    ActionType crud_type   = 1;
    string     custom_type = 2;
    ResultType result      = 3;
    string     details     = 4;
  }

  khaleesi.core.RequestMetadata request_metadata = 1;
  Metadata                      metadata         = 2;
  Target                        target           = 3;
  Action                        action           = 4;
}

message LogResponse {
  enum ResultType {
    UNKNOWN       = 0;
    SUCCESS       = 1;
    PARSING_ERROR = 2;
    FATAL_ERROR   = 3;
  }
  ResultType result = 1;
  string     errors = 2;
}

service Lumberjack {
  rpc LogEvent (Event) returns (LogResponse);
}

message LogFilter {

}

message EventsList {
  repeated Event events = 1;
}

service Sawyer {
  rpc GetEvents(LogFilter) returns (EventsList);
}
